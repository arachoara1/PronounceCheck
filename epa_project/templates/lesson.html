<body>
    <!-- Lesson 정보 표시 -->
    <h1 id="lesson-title">{{ lesson.title }}</h1>
    <div class="content">
        <h2>레벨: <span id="lesson-level">{{ lesson.level }}</span></h2>
        <p id="lesson-sentence">{{ lesson.sentence }}</p>
    </div>

    <!-- 마지막으로 읽은 시간 표시 -->
    <div>
        <h3>마지막으로 읽은 시간</h3>
        <p>{{ lesson.last_read_at }}</p>
    </div>

    <!-- Lesson Audio File -->
    <div class="content">
        <h3>표준 발음 오디오</h3>
        <audio id="lesson-audio" controls>
            <source src="{{ lesson.audio_file }}" type="audio/mpeg">
            오디오 파일을 재생할 수 없습니다.
        </audio>
    </div>

    <!-- 이전 및 다음 버튼 -->
    <div class="navigation-buttons">
        <button id="prev-btn" onclick="loadPrevLesson()">이전</button>
        <button id="next-btn" onclick="loadNextLesson()">다음</button>
    </div>

    <!-- 녹음 상태 표시 -->
    <div id="recording-status" style="text-align: center; margin-top: 10px; font-size: 16px; color: red;"></div>

    <!-- 녹음 및 업로드 버튼 -->
    <div class="buttons">
        <button id="record-btn" onclick="startRecording()">녹음 시작</button>
        <button id="stop-btn" onclick="stopRecording()" disabled>녹음 중지</button>
        <button id="upload-btn" onclick="uploadAudio()" disabled>업로드</button>
        <button id="retry-btn" onclick="retryRecording()" disabled>녹음 다시하기</button>
    </div>
    <audio id="audio-preview" controls></audio>

    <script>
        const lessons = {{ lessons|safe }}; // 모든 레슨 데이터를 JavaScript로 전달
        let currentLessonIndex = {{ current_lesson_index }}; // 현재 레슨 인덱스

        function updateLessonView() {
            const lesson = lessons[currentLessonIndex];
            document.getElementById("lesson-title").textContent = lesson.title;
            document.getElementById("lesson-level").textContent = lesson.level;
            document.getElementById("lesson-sentence").textContent = lesson.sentence;
            const audioSource = document.getElementById("lesson-audio").querySelector("source");
            audioSource.src = lesson.audio_file;
            document.getElementById("lesson-audio").load();
        }

        function loadPrevLesson() {
            if (currentLessonIndex > 0) {
                currentLessonIndex--;
                updateLessonView();
            } else {
                alert("이전 레슨이 없습니다!");
            }
        }

        function loadNextLesson() {
            if (currentLessonIndex < lessons.length - 1) {
                currentLessonIndex++;
                updateLessonView();
            } else {
                alert("다음 레슨이 없습니다!");
            }
        }
    </script>
</body>
